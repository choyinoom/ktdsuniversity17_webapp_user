<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.member">
	<resultMap id="memResult" type="memberVO">
		<result property="id" column="mem_id" />
		<result property="pw" column="mem_pw" />
		<result property="name" column="mem_name" />
		<result property="tel" column="mem_tel" />
		<result property="phone" column="mem_phone" />
		<result property="email" column="mem_email" />
		<result property="subscription" column="mem_subscription" />
		<result property="companyName" column="mem_company_name" />
		<result property="delYN" column="mem_delYN" />
		<result property="joinDate" column="mem_join_date" />
		<result property="modDate" column="mem_mod_date" />
		<result property="loginFail" column="mem_login_fail" />
	</resultMap>
	
	<resultMap id="enrdResult" type="enrollmentDetailVO">
		<id property="id" column="enrd_id"/>
		<result property="crsId" column="crs_id"/>
		<result property="memId" column="mem_id"/>
		<result property="stat" column="enrd_stat"/>
		<result property="joinDate" column="enrd_join_date"/>
		<result property="modDate" column="enrd_mod_date"/>
		<result property="completeDate" column="enrd_complete_date"/>
		<association property="syllabusVO" resultMap="mapper.course.slbResult"/>
		<association property="courseVO" resultMap="mapper.course.crsResult"/>
	</resultMap>

	

	<!-- 아이디 중복체크 -->
	<select id="selectMember" resultType="int">
	<![CDATA[
		select COUNT(*) from member	
		where mem_id=#{id} 	
	]]>
	</select>


	<!-- 회원 가입 -->
	<insert id="insertMember" parameterType="memberVO">
		<![CDATA[
		 insert into member(mem_name, mem_id, mem_pw, mem_tel, mem_phone, mem_email, mem_subscription, mem_company_name)
		 values(#{name}, #{id}, #{pw}, #{tel, jdbcType=VARCHAR}, #{phone, jdbcType=VARCHAR}, #{email}, #{subscription}, #{companyName})
		]]>
	</insert>

	<!-- 정보 수정 -->
	<update id="updateMember" parameterType="memberVO">
		<![CDATA[
	     update t_member
	     set pwd=#{pwd}, name=#{name}, email=#{email}
	     where
	     id=#{id}
      ]]>
	</update>

	<!-- 회원 탈퇴 -->
	<delete id="deleteMember" parameterType="String">
		<![CDATA[
	   UPDATE member
	   SET delYN = true
	   WHERE id = #{id}
	]]>
	</delete>

	<!-- 로그인, 세션에 저장할 정보만 불러온다 -->
	<select id="loginById" resultMap="memResult" parameterType="memberVO">
	<![CDATA[
		SELECT 
			mem_id, 
			mem_name 
		FROM member	
		WHERE mem_id=#{id} and mem_pw=#{pw}		
	]]>
	</select>

	<!-- 회원의 수강내역 현황 -->
	<select id="selectEnrollmentDetailByEnrollMap" parameterType="java.util.Map" resultMap="enrdResult">
	<![CDATA[
		SELECT enrd_id, crs_id, mem_id, enrd_stat
		FROM enrollment_detail
		WHERE crs_id = #{courseId} AND mem_id = #{id}
	]]>
	</select>
	
	<!-- 회원 정보 수정 시 필요한 정보 -->
	<select id="selectMemberInfoById" parameterType="string" resultMap="memResult">
	<![CDATA[
		SELECT 
			mem_id,
			mem_name,
			mem_tel,
			mem_phone,
			mem_email,
			mem_subscription,
			mem_company_name
		FROM member
		WHERE mem_id = #{id}
	]]>
	</select>
	
	<select id="selectMemberPwInfoById" parameterType="string" resultMap="memResult">
	<![CDATA[
		SELECT 
		
		mem_pw
		FROM member
		WHERE mem_id = #{id}
	]]>
	</select>
	
	<!--비밀번호변경 -->
	<update id = "updatePwOfMember"  parameterType="memberVO">
	<![CDATA[
		update member
		set 
		mem_pw = #{pw}
		WHERE mem_id = #{id}
	]]>
	
	</update>
	
	
	

</mapper>